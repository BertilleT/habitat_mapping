INFO:albumentations.check_version:A new version of Albumentations is available: 1.4.11 (you have 1.4.10). Upgrade using: pip install --upgrade albumentations
----------------------- UNet -----------------------
Patch size: 64
Classification level: 1
Using device: cuda
Loading data...
Data loading settings:
Splitting data: [0.68, 0.2]
Stratified: zone
Year: all
Patches: all
Batch size: 4096
Normalisation: channel_by_channel
No data augmentation
The seed to shuffle the data is  1
The data are from  all  year
Nbumber of unique zones: 108
Train, val and test zones saved in csv file at: ../../results/resnet18_64_l1/stratified_shuffling_by_zone/seed1/img_ids_by_set.csv
Image: min: 0.0, max: 1.0
Mask unique values: [0. 1.]
Train: 102118 images, Val: 36030 images, Test: 32320 images
Train: 59.90%, Val: 21.14%, Test: 18.96%
Creating model...
Model settings:
Pretrained: True
Classes: 7
The model is Resnet18
Pretrained weights loaded
Using BCEWithDigits criterion
Creating optimizer...
Training settings:
Learning rate: 0.001
Criterion: BCEWithDigits
Optimizer: Adam
Training...
Epoch 1/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 1/60: train loss 0.3480, val loss 0.5358
Epoch 1/60: train mF1 0.5244, val mF1 0.2786
Time: 0:07:20.850351
Epoch 2/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 2/60: train loss 0.2525, val loss 0.4681
Epoch 2/60: train mF1 0.6670, val mF1 0.3636
Time: 0:07:24.484732
Epoch 3/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 3/60: train loss 0.2126, val loss 0.5270
Epoch 3/60: train mF1 0.7261, val mF1 0.3589
Time: 0:07:27.946270
Epoch 4/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 4/60: train loss 0.1704, val loss 0.5951
Epoch 4/60: train mF1 0.7876, val mF1 0.3665
Time: 0:07:25.792993
Epoch 5/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 5/60: train loss 0.1255, val loss 0.6721
Epoch 5/60: train mF1 0.8511, val mF1 0.3366
Time: 0:07:25.307258
Epoch 6/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 6/60: train loss 0.0895, val loss 0.7581
Epoch 6/60: train mF1 0.8999, val mF1 0.3375
Time: 0:07:24.571463
Epoch 7/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 7/60: train loss 0.0589, val loss 0.8497
Epoch 7/60: train mF1 0.9387, val mF1 0.3221
Time: 0:07:26.255765
Epoch 8/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 8/60: train loss 0.0407, val loss 0.9029
Epoch 8/60: train mF1 0.9599, val mF1 0.3637
Time: 0:07:25.303810
Epoch 9/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 9/60: train loss 0.0281, val loss 1.0190
Epoch 9/60: train mF1 0.9741, val mF1 0.3456
Time: 0:07:21.867752
Epoch 10/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 10/60: train loss 0.0196, val loss 1.0788
Epoch 10/60: train mF1 0.9831, val mF1 0.3422
Time: 0:07:26.340617
Epoch 11/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 11/60: train loss 0.0124, val loss 1.1281
Epoch 11/60: train mF1 0.9903, val mF1 0.3232
Time: 0:07:28.729182
Epoch 12/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 12/60: train loss 0.0084, val loss 1.1411
Epoch 12/60: train mF1 0.9938, val mF1 0.3372
Time: 0:07:27.106573
Epoch 13/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 13/60: train loss 0.0069, val loss 1.2176
Epoch 13/60: train mF1 0.9953, val mF1 0.3417
Time: 0:07:31.986017
Epoch 14/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 14/60: train loss 0.0063, val loss 1.1502
Epoch 14/60: train mF1 0.9956, val mF1 0.3486
Time: 0:07:27.151632
Epoch 15/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 15/60: train loss 0.0036, val loss 1.1740
Epoch 15/60: train mF1 0.9978, val mF1 0.3491
Time: 0:07:23.490909
Epoch 16/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 16/60: train loss 0.0027, val loss 1.1827
Epoch 16/60: train mF1 0.9986, val mF1 0.3635
Time: 0:07:23.360948
Epoch 17/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 17/60: train loss 0.0021, val loss 1.2614
Epoch 17/60: train mF1 0.9991, val mF1 0.3312
Time: 0:07:26.852467
Epoch 18/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 18/60: train loss 0.0011, val loss 1.2437
Epoch 18/60: train mF1 0.9996, val mF1 0.3530
Time: 0:07:25.478550
Epoch 19/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 19/60: train loss 0.0007, val loss 1.2809
Epoch 19/60: train mF1 0.9998, val mF1 0.3487
Time: 0:07:26.176470
Epoch 20/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 20/60: train loss 0.0004, val loss 1.2874
Epoch 20/60: train mF1 0.9999, val mF1 0.3528
Time: 0:07:24.029917
Epoch 21/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 21/60: train loss 0.0003, val loss 1.2998
Epoch 21/60: train mF1 1.0000, val mF1 0.3457
Time: 0:07:23.909548
Epoch 22/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 22/60: train loss 0.0002, val loss 1.3127
Epoch 22/60: train mF1 1.0000, val mF1 0.3468
Time: 0:07:25.515121
Epoch 23/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 23/60: train loss 0.0001, val loss 1.3198
Epoch 23/60: train mF1 1.0000, val mF1 0.3475
Time: 0:07:22.425411
Epoch 24/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 24/60: train loss 0.0001, val loss 1.3249
Epoch 24/60: train mF1 1.0000, val mF1 0.3477
Time: 0:07:23.096931
Epoch 25/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 25/60: train loss 0.0001, val loss 1.3307
Epoch 25/60: train mF1 1.0000, val mF1 0.3466
Time: 0:07:22.367884
Epoch 26/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 26/60: train loss 0.0001, val loss 1.3339
Epoch 26/60: train mF1 1.0000, val mF1 0.3475
Time: 0:07:21.790820
Epoch 27/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 27/60: train loss 0.0001, val loss 1.3399
Epoch 27/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:22.917886
Epoch 28/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 28/60: train loss 0.0001, val loss 1.3456
Epoch 28/60: train mF1 1.0000, val mF1 0.3469
Time: 0:07:21.468315
Epoch 29/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 29/60: train loss 0.0001, val loss 1.3512
Epoch 29/60: train mF1 1.0000, val mF1 0.3470
Time: 0:07:31.527606
Epoch 30/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 30/60: train loss 0.0001, val loss 1.3539
Epoch 30/60: train mF1 1.0000, val mF1 0.3473
Time: 0:07:30.348295
Epoch 31/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 31/60: train loss 0.0001, val loss 1.3581
Epoch 31/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:26.714558
Epoch 32/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 32/60: train loss 0.0001, val loss 1.3665
Epoch 32/60: train mF1 1.0000, val mF1 0.3468
Time: 0:07:20.981858
Epoch 33/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 33/60: train loss 0.0001, val loss 1.3672
Epoch 33/60: train mF1 1.0000, val mF1 0.3468
Time: 0:07:25.397487
Epoch 34/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 34/60: train loss 0.0001, val loss 1.3701
Epoch 34/60: train mF1 1.0000, val mF1 0.3466
Time: 0:07:23.993418
Epoch 35/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 35/60: train loss 0.0001, val loss 1.3750
Epoch 35/60: train mF1 1.0000, val mF1 0.3467
Time: 0:07:23.676300
Epoch 36/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 36/60: train loss 0.0001, val loss 1.3779
Epoch 36/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:25.476452
Epoch 37/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 37/60: train loss 0.0001, val loss 1.3817
Epoch 37/60: train mF1 1.0000, val mF1 0.3466
Time: 0:07:25.099067
Epoch 38/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 38/60: train loss 0.0000, val loss 1.3862
Epoch 38/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:25.905262
Epoch 39/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 39/60: train loss 0.0000, val loss 1.3899
Epoch 39/60: train mF1 1.0000, val mF1 0.3466
Time: 0:07:24.506816
Epoch 40/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 40/60: train loss 0.0000, val loss 1.3941
Epoch 40/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:24.785290
Epoch 41/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 41/60: train loss 0.0000, val loss 1.3975
Epoch 41/60: train mF1 1.0000, val mF1 0.3467
Time: 0:07:27.848771
Epoch 42/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 42/60: train loss 0.0000, val loss 1.4018
Epoch 42/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:21.036333
Epoch 43/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 43/60: train loss 0.0000, val loss 1.4044
Epoch 43/60: train mF1 1.0000, val mF1 0.3469
Time: 0:07:21.206129
Epoch 44/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 44/60: train loss 0.0000, val loss 1.4077
Epoch 44/60: train mF1 1.0000, val mF1 0.3473
Time: 0:07:22.695161
Epoch 45/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 45/60: train loss 0.0000, val loss 1.4100
Epoch 45/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:26.407498
Epoch 46/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 46/60: train loss 0.0000, val loss 1.4153
Epoch 46/60: train mF1 1.0000, val mF1 0.3468
Time: 0:07:27.322586
Epoch 47/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 47/60: train loss 0.0000, val loss 1.4185
Epoch 47/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:27.726507
Epoch 48/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 48/60: train loss 0.0000, val loss 1.4227
Epoch 48/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:41.039676
Epoch 49/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 49/60: train loss 0.0000, val loss 1.4216
Epoch 49/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:31.201676
Epoch 50/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 50/60: train loss 0.0000, val loss 1.4289
Epoch 50/60: train mF1 1.0000, val mF1 0.3475
Time: 0:07:21.429860
Epoch 51/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 51/60: train loss 0.0000, val loss 1.4314
Epoch 51/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:04.639448
Epoch 52/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 52/60: train loss 0.0000, val loss 1.4361
Epoch 52/60: train mF1 1.0000, val mF1 0.3476
Time: 0:07:04.729952
Epoch 53/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 53/60: train loss 0.0000, val loss 1.4327
Epoch 53/60: train mF1 1.0000, val mF1 0.3476
Time: 0:07:06.072206
Epoch 54/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 54/60: train loss 0.0000, val loss 1.4412
Epoch 54/60: train mF1 1.0000, val mF1 0.3471
Time: 0:07:03.553575
Epoch 55/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 55/60: train loss 0.0000, val loss 1.4425
Epoch 55/60: train mF1 1.0000, val mF1 0.3474
Time: 0:07:05.033430
Epoch 56/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 56/60: train loss 0.0000, val loss 1.4466
Epoch 56/60: train mF1 1.0000, val mF1 0.3470
Time: 0:07:11.291841
Epoch 57/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 57/60: train loss 0.0000, val loss 1.4493
Epoch 57/60: train mF1 1.0000, val mF1 0.3469
Time: 0:07:21.600875
Epoch 58/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 58/60: train loss 0.0000, val loss 1.4530
Epoch 58/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:20.638643
Epoch 59/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 59/60: train loss 0.0000, val loss 1.4557
Epoch 59/60: train mF1 1.0000, val mF1 0.3472
Time: 0:07:03.458484
Epoch 60/60
Training
Batch: 0  over  25
Validation
Batch: 0  over  9
Epoch 60/60: train loss 0.0000, val loss 1.4549
Epoch 60/60: train mF1 1.0000, val mF1 0.3475
/home/bertille/.local/lib/python3.8/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet18_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet18_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
Time: 0:07:03.582253
Testing
Batch: 0  over  8
Test F1 by class: [0.25374493 0.19848101 0.64355405 0.30754077 0.61935731 0.04663383
 0.46179273]
Test mF1: 0.36158637426718904
Plot saved at: ../../results/resnet18_64_l1/stratified_shuffling_by_zone/all/resnet18_multi_label_64_zone_60epochs_bs4096_pre_trained/metrics_test/test_preds.png
Reassembling the patches...
Reassembling the patches...
Reassembling the patches...
